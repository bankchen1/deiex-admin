# ç»ˆæè°ƒè¯•æŒ‡å— - è§£å†³"æ— æ•°æ®"é—®é¢˜

## ğŸ¯ é—®é¢˜ç°çŠ¶

- âœ… æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤
- âœ… MockæœåŠ¡ä»£ç å·²å®Œæˆ
- âŒ é¡µé¢æ˜¾ç¤º"æ— æ•°æ®"
- âŒ åˆ—è¡¨é¡µé¢çœ‹ä¸åˆ°æ•°æ®

## ğŸ” è¯Šæ–­æ­¥éª¤

### æ­¥éª¤1ï¼šä½¿ç”¨æµ‹è¯•é¡µé¢

1. ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼š`npm run dev`
2. åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š**http://localhost:5173/test-mock.html**
3. æŒ‰é¡ºåºç‚¹å‡»æ‰€æœ‰æµ‹è¯•æŒ‰é’®
4. æŸ¥çœ‹æ¯ä¸ªæµ‹è¯•çš„ç»“æœ

**é¢„æœŸç»“æœ**ï¼š
- âœ… Mock mode is ENABLED
- âœ… æ‰€æœ‰APIè°ƒç”¨æˆåŠŸ
- âœ… è¿”å›çš„æ•°æ®æœ‰å†…å®¹

**å¦‚æœå¤±è´¥**ï¼š
- æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
- æˆªå›¾æµ‹è¯•ç»“æœ
- ç»§ç»­ä¸‹ä¸€æ­¥

### æ­¥éª¤2ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

æ‰“å¼€ä¸»åº”ç”¨ï¼ˆhttp://localhost:5173ï¼‰ï¼ŒæŒ‰F12æ‰“å¼€æ§åˆ¶å°ã€‚

**åº”è¯¥çœ‹åˆ°**ï¼š
```
ğŸ­ MOCK MODE ACTIVE
Mock mode is active. All API calls return mock data.
```

**å¦‚æœæ²¡æœ‰çœ‹åˆ°**ï¼š
1. æ£€æŸ¥ `.env.development` æ–‡ä»¶
2. ç¡®è®¤æœ‰ `VITE_USE_MOCK=true`
3. é‡å¯å¼€å‘æœåŠ¡å™¨
4. ç¡¬åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl+Shift+Rï¼‰

### æ­¥éª¤3ï¼šæ‰‹åŠ¨æµ‹è¯•API

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š

```javascript
// æµ‹è¯•1ï¼šæ£€æŸ¥ç¯å¢ƒ
console.log('Mock mode:', import.meta.env.VITE_USE_MOCK)

// æµ‹è¯•2ï¼šæµ‹è¯•APIå®¢æˆ·ç«¯
const testApi = async () => {
  try {
    const { apiClient } = await import('/src/services/api/AdminApiClient.ts')
    console.log('âœ… API Client loaded')
    
    const response = await apiClient.get('/admin/dashboard/stats')
    console.log('âœ… Response:', response)
    console.log('âœ… Response.data:', response.data)
    
    return response
  } catch (error) {
    console.error('âŒ Error:', error)
    return null
  }
}

await testApi()
```

**é¢„æœŸè¾“å‡º**ï¼š
```javascript
âœ… API Client loaded
[Mock Service] GET /admin/dashboard/stats
[Mock Service] Config: {...}
[Mock Service] Response: { success: true, data: {...}, message: '...' }
âœ… Response: { success: true, data: {...}, message: '...' }
âœ… Response.data: { registrations: {...}, activeUsers: {...}, ... }
```

### æ­¥éª¤4ï¼šæµ‹è¯•Store

```javascript
// æµ‹è¯•Dashboard Store
const testStore = async () => {
  const { useDashboardStore } = await import('/src/stores/dashboard.ts')
  const store = useDashboardStore()
  
  console.log('Before fetch:')
  console.log('- Stats:', store.stats)
  console.log('- Loading:', store.statsLoading)
  console.log('- Error:', store.error)
  
  await store.fetchStats()
  
  console.log('After fetch:')
  console.log('- Stats:', store.stats)
  console.log('- Loading:', store.statsLoading)
  console.log('- Error:', store.error)
  
  if (store.stats) {
    console.log('âœ… Data loaded!')
    console.log('Registrations:', store.stats.registrations)
  } else {
    console.error('âŒ No data!')
  }
}

await testStore()
```

## ğŸ› å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šæ§åˆ¶å°æ²¡æœ‰"Mock Service"æ—¥å¿—

**ç—‡çŠ¶**ï¼šçœ‹ä¸åˆ° `[Mock Service] GET ...` æ—¥å¿—

**åŸå› **ï¼šMockæœåŠ¡æœªåˆå§‹åŒ–æˆ–æ‹¦æˆªå™¨æœªè®¾ç½®

**è§£å†³**ï¼š

1. æ£€æŸ¥ `src/services/api/AdminApiClient.ts` çš„constructorï¼š
```typescript
if (import.meta.env.VITE_USE_MOCK === 'true') {
  mockService.enable()
  mockService.setupInterceptor(this.axiosInstance)
}
```

2. åœ¨ `src/main.ts` ä¸­æ·»åŠ æ—¥å¿—ï¼š
```typescript
import { mockService } from '@/services/mock'

console.log('Mock mode:', import.meta.env.VITE_USE_MOCK)
console.log('Mock service enabled:', mockService.isEnabled())
```

3. é‡å¯å¼€å‘æœåŠ¡å™¨

### é—®é¢˜2ï¼šçœ‹åˆ°"Mock response (default)"

**ç—‡çŠ¶**ï¼šæ§åˆ¶å°æ˜¾ç¤ºé»˜è®¤å“åº”è€Œä¸æ˜¯å…·ä½“æ•°æ®

**åŸå› **ï¼šURLæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•å¤„ç†å™¨

**è°ƒè¯•**ï¼š

åœ¨ `src/services/mock/index.ts` çš„ `getMockResponse` æ–¹æ³•å¼€å¤´æ·»åŠ ï¼š
```typescript
console.log('[Mock Debug] URL:', url)
console.log('[Mock Debug] Method:', method)
```

æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®ï¼Œä¾‹å¦‚ï¼š
- âœ… `/admin/dashboard/stats`
- âŒ `/dashboard/stats` (ç¼ºå°‘/admin)

### é—®é¢˜3ï¼šTypeScriptæ¨¡å—é”™è¯¯

**ç—‡çŠ¶**ï¼š
```
Cannot find module './modules/users'
```

**è§£å†³**ï¼š

```bash
# 1. åœæ­¢å¼€å‘æœåŠ¡å™¨ (Ctrl+C)

# 2. æ¸…é™¤ç¼“å­˜
rm -rf node_modules/.vite
rm -rf dist

# 3. é‡æ–°å®‰è£…ï¼ˆå¦‚æœéœ€è¦ï¼‰
npm install

# 4. é‡å¯
npm run dev
```

### é—®é¢˜4ï¼šæ•°æ®ç»“æ„ä¸åŒ¹é…

**ç—‡çŠ¶**ï¼šAPIè¿”å›æ•°æ®ï¼Œä½†ç»„ä»¶ä¸æ˜¾ç¤º

**è°ƒè¯•**ï¼š

1. æ£€æŸ¥APIè¿”å›çš„æ•°æ®ç»“æ„ï¼š
```javascript
const response = await apiClient.get('/admin/users')
console.log('Response structure:', Object.keys(response))
console.log('Data structure:', Object.keys(response.data))
```

2. æ£€æŸ¥ç»„ä»¶æœŸæœ›çš„æ•°æ®ï¼š
```javascript
// åœ¨ç»„ä»¶ä¸­æ·»åŠ 
console.log('Props:', props)
console.log('Data source:', props.dataSource)
```

3. å¯¹æ¯”ä¸¤è€…æ˜¯å¦åŒ¹é…

### é—®é¢˜5ï¼šé¡µé¢ä¸€ç›´Loading

**ç—‡çŠ¶**ï¼šé¡µé¢æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œæ°¸ä¸ç»“æŸ

**åŸå› **ï¼š
- APIè°ƒç”¨å¤±è´¥ä½†æ²¡æœ‰æ•è·é”™è¯¯
- LoadingçŠ¶æ€æ²¡æœ‰é‡ç½®
- Promiseæ²¡æœ‰resolve

**è°ƒè¯•**ï¼š

```javascript
// æ£€æŸ¥loadingçŠ¶æ€
const { useDashboardStore } = await import('/src/stores/dashboard.ts')
const store = useDashboardStore()

// ç›‘å¬loadingå˜åŒ–
setInterval(() => {
  console.log('Loading:', store.statsLoading)
}, 1000)

// å°è¯•fetch
await store.fetchStats()
```

## ğŸ”§ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå®Œå…¨é‡ç½®

```bash
# åœæ­¢æœåŠ¡å™¨
# Ctrl+C

# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
rm -rf node_modules/.vite
rm -rf dist
rm -rf node_modules/.cache

# ç¡®è®¤ç¯å¢ƒå˜é‡
cat .env.development

# åº”è¯¥åŒ…å«ï¼š
# VITE_USE_MOCK=true

# é‡å¯
npm run dev
```

### æ–¹æ¡ˆ2ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿—

åœ¨ `src/services/api/AdminApiClient.ts` çš„å“åº”æ‹¦æˆªå™¨ä¸­ï¼š

```typescript
this.axiosInstance.interceptors.response.use(
  (response) => {
    console.log('[API Client] Response:', response)
    console.log('[API Client] Response.data:', response.data)
    return response.data
  },
  // ...
)
```

åœ¨ `src/stores/dashboard.ts` çš„ `fetchStats` ä¸­ï¼š

```typescript
async function fetchStats(params?: DashboardQueryParams) {
  console.log('[Dashboard Store] Fetching stats...')
  statsLoading.value = true
  error.value = null
  try {
    const response = await dashboardApi.getStats(params)
    console.log('[Dashboard Store] API Response:', response)
    console.log('[Dashboard Store] Response.data:', response.data)
    stats.value = response.data
    console.log('[Dashboard Store] Stats set to:', stats.value)
    return response
  } catch (e: any) {
    console.error('[Dashboard Store] Error:', e)
    error.value = e.message || 'Failed to fetch dashboard stats'
    throw e
  } finally {
    statsLoading.value = false
    console.log('[Dashboard Store] Fetch complete')
  }
}
```

### æ–¹æ¡ˆ3ï¼šç®€åŒ–MockæœåŠ¡

å¦‚æœå¤æ‚çš„mockæœåŠ¡æœ‰é—®é¢˜ï¼Œä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬ï¼š

åˆ›å»º `src/services/mock/simple.ts`ï¼š

```typescript
import type { AxiosInstance } from 'axios'

export function setupSimpleMock(axios: AxiosInstance) {
  console.log('[Simple Mock] Setting up...')
  
  axios.interceptors.request.use((config) => {
    console.log('[Simple Mock] Intercepting:', config.url)
    
    // ç®€å•çš„mockæ•°æ®
    const mockData = {
      success: true,
      data: {
        message: 'Simple mock data',
        items: [1, 2, 3],
        total: 3
      },
      message: 'OK'
    }
    
    return Promise.reject({
      config,
      response: {
        data: mockData,
        status: 200,
        statusText: 'OK',
        headers: {},
        config
      },
      __MOCK__: true
    })
  })
  
  axios.interceptors.response.use(
    (response) => response,
    (error) => {
      if (error.__MOCK__) {
        console.log('[Simple Mock] Returning mock data:', error.response.data)
        return Promise.resolve(error.response.data)
      }
      return Promise.reject(error)
    }
  )
  
  console.log('[Simple Mock] Setup complete')
}
```

åœ¨ `AdminApiClient.ts` ä¸­ä½¿ç”¨ï¼š

```typescript
// ä¸´æ—¶æ›¿æ¢
// import { mockService } from '@/services/mock'
import { setupSimpleMock } from '@/services/mock/simple'

// åœ¨constructorä¸­
if (import.meta.env.VITE_USE_MOCK === 'true') {
  // mockService.enable()
  // mockService.setupInterceptor(this.axiosInstance)
  setupSimpleMock(this.axiosInstance)
}
```

## ğŸ“Š è¯Šæ–­æ¸…å•

ä½¿ç”¨è¿™ä¸ªæ¸…å•é€é¡¹æ£€æŸ¥ï¼š

- [ ] å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- [ ] `.env.development` åŒ…å« `VITE_USE_MOCK=true`
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º "ğŸ­ MOCK MODE ACTIVE"
- [ ] æµ‹è¯•é¡µé¢æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ§åˆ¶å°æ˜¾ç¤º `[Mock Service]` æ—¥å¿—
- [ ] APIè°ƒç”¨è¿”å›æ•°æ®ï¼ˆä¸æ˜¯nullæˆ–undefinedï¼‰
- [ ] Storeçš„statsä¸æ˜¯null
- [ ] ç»„ä»¶æ”¶åˆ°propsæ•°æ®
- [ ] æ²¡æœ‰TypeScriptç¼–è¯‘é”™è¯¯
- [ ] æ²¡æœ‰çº¢è‰²æ§åˆ¶å°é”™è¯¯

## ğŸ¯ æœ€ç»ˆéªŒè¯

å¦‚æœæ‰€æœ‰æ­¥éª¤éƒ½å®Œæˆï¼Œè¿è¡Œè¿™ä¸ªå®Œæ•´æµ‹è¯•ï¼š

```javascript
// å®Œæ•´æµ‹è¯•è„šæœ¬
const fullTest = async () => {
  console.log('=== å¼€å§‹å®Œæ•´æµ‹è¯• ===')
  
  // 1. ç¯å¢ƒæ£€æŸ¥
  console.log('1. ç¯å¢ƒæ£€æŸ¥')
  console.log('Mock mode:', import.meta.env.VITE_USE_MOCK)
  
  // 2. APIå®¢æˆ·ç«¯æµ‹è¯•
  console.log('2. APIå®¢æˆ·ç«¯æµ‹è¯•')
  const { apiClient } = await import('/src/services/api/AdminApiClient.ts')
  const apiResponse = await apiClient.get('/admin/dashboard/stats')
  console.log('API Response:', apiResponse)
  
  // 3. Storeæµ‹è¯•
  console.log('3. Storeæµ‹è¯•')
  const { useDashboardStore } = await import('/src/stores/dashboard.ts')
  const store = useDashboardStore()
  await store.fetchStats()
  console.log('Store stats:', store.stats)
  
  // 4. ç”¨æˆ·APIæµ‹è¯•
  console.log('4. ç”¨æˆ·APIæµ‹è¯•')
  const usersResponse = await apiClient.get('/admin/users')
  console.log('Users:', usersResponse.data)
  
  // 5. ç»“æœ
  console.log('=== æµ‹è¯•å®Œæˆ ===')
  if (store.stats && usersResponse.data) {
    console.log('âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼')
    return true
  } else {
    console.error('âŒ æµ‹è¯•å¤±è´¥')
    return false
  }
}

await fullTest()
```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæŒ‰ç…§ä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ä»ç„¶æ— æ³•è§£å†³ï¼Œè¯·æä¾›ï¼š

1. **æµ‹è¯•é¡µé¢æˆªå›¾** - http://localhost:5173/test-mock.html çš„æ‰€æœ‰æµ‹è¯•ç»“æœ
2. **æ§åˆ¶å°æˆªå›¾** - åŒ…æ‹¬æ‰€æœ‰æ—¥å¿—å’Œé”™è¯¯
3. **Networkæ ‡ç­¾æˆªå›¾** - æ˜¾ç¤ºAPIè¯·æ±‚
4. **ç¯å¢ƒä¿¡æ¯**ï¼š
   ```bash
   node -v
   npm -v
   cat .env.development
   ```

è¿™æ ·å¯ä»¥æ›´å‡†ç¡®åœ°è¯Šæ–­é—®é¢˜ï¼
